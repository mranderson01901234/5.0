{
  "auditTimestamp": "2025-11-01T00:00:00.000Z",
  "auditVersion": "1.0.0",
  "config": {
    "flags": {
      "memoryEvents": {
        "source": "apps/llm-gateway/config/llm-gateway.json",
        "current": true,
        "description": "Enable/disable memory event emission from gateway"
      },
      "fr": {
        "source": "apps/llm-gateway/config/llm-gateway.json",
        "current": true,
        "description": "Fast Response feature flag"
      }
    },
    "environment": {
      "PORT": {
        "source": "apps/memory-service/src/server.ts",
        "current": "3001",
        "description": "Memory service port"
      },
      "HOST": {
        "source": "apps/memory-service/src/server.ts",
        "current": "0.0.0.0",
        "description": "Memory service bind address"
      },
      "DB_PATH": {
        "source": "apps/memory-service/src/server.ts",
        "current": "./data/memory.db",
        "description": "SQLite database path"
      },
      "MEMORY_SERVICE_URL": {
        "source": "apps/llm-gateway/src/memoryEmitter.ts",
        "current": "http://localhost:3001",
        "description": "Memory service endpoint for gateway"
      },
      "LOG_LEVEL": {
        "source": "apps/memory-service/src/server.ts",
        "current": "info",
        "description": "Logging verbosity level"
      },
      "FEATURE_MEMORY_AUDIT": {
        "current": "NOT_PRESENT",
        "description": "Feature flag for audit instrumentation (will add)"
      }
    },
    "cadence": {
      "msgThreshold": {
        "source": "apps/memory-service/src/cadence.ts",
        "current": 6,
        "description": "Trigger audit after N messages"
      },
      "tokenThreshold": {
        "source": "apps/memory-service/src/cadence.ts",
        "current": 1500,
        "description": "Trigger audit after N tokens"
      },
      "timeThresholdMs": {
        "source": "apps/memory-service/src/cadence.ts",
        "current": 180000,
        "description": "Trigger audit after N milliseconds (3 min)"
      },
      "debounceMs": {
        "source": "apps/memory-service/src/cadence.ts",
        "current": 30000,
        "description": "Minimum time between audits per thread (30s)"
      }
    },
    "thresholds": {
      "save": {
        "source": "apps/memory-service/config/memory.json",
        "current": 0.65,
        "description": "Minimum quality score to save memory"
      },
      "high": {
        "source": "apps/memory-service/config/memory.json",
        "current": 0.80,
        "description": "High-value memory threshold"
      },
      "maxPerAudit": {
        "source": "apps/memory-service/config/memory.json",
        "current": 3,
        "description": "Maximum memories saved per audit"
      }
    },
    "limits": {
      "maxEntryChars": {
        "source": "apps/memory-service/config/memory.json",
        "current": 1024,
        "description": "Maximum characters per memory content"
      },
      "maxPerUser": {
        "source": "apps/memory-service/config/memory.json",
        "current": 1000,
        "description": "Maximum memories per user"
      }
    },
    "privacy": {
      "redact": {
        "source": "apps/memory-service/config/memory.json",
        "current": true,
        "description": "Enable PII redaction"
      },
      "patterns": [
        "EMAIL_REGEX",
        "PHONE_REGEX",
        "SSN_REGEX",
        "CREDIT_CARD_REGEX",
        "API_KEY_REGEX",
        "JWT_REGEX",
        "IPV4_REGEX"
      ]
    },
    "queue": {
      "batchWindowMs": {
        "source": "apps/memory-service/src/queue.ts",
        "current": 300,
        "description": "Write-behind batching window"
      },
      "maxRetries": {
        "source": "apps/memory-service/src/queue.ts",
        "current": 3,
        "description": "Maximum job retry attempts"
      },
      "retryDelayMs": {
        "source": "apps/memory-service/src/queue.ts",
        "current": 1000,
        "description": "Base retry delay in milliseconds"
      }
    },
    "recall": {
      "deadlineMs": {
        "source": "apps/memory-service/config/memory.json",
        "current": 30,
        "description": "Async recall query deadline"
      },
      "maxItems": {
        "source": "apps/memory-service/config/memory.json",
        "current": 5,
        "description": "Maximum memories returned per recall"
      }
    },
    "emitter": {
      "timeoutMs": {
        "source": "apps/llm-gateway/src/memoryEmitter.ts",
        "current": 50,
        "description": "Fire-and-forget HTTP timeout"
      }
    },
    "tiers": {
      "TIER1": {
        "ttlDays": 120,
        "decayPerWeek": 0.01,
        "saveThreshold": 0.62,
        "priorityFloor": 0.35
      },
      "TIER2": {
        "ttlDays": 365,
        "decayPerWeek": 0.005,
        "saveThreshold": 0.70,
        "priorityFloor": 0.50
      },
      "TIER3": {
        "ttlDays": 90,
        "decayPerWeek": 0.02,
        "saveThreshold": 0.70,
        "priorityFloor": 0.30
      }
    },
    "database": {
      "journalMode": "WAL",
      "synchronous": "NORMAL",
      "tempStore": "MEMORY",
      "mmapSize": 268435456,
      "cacheSize": -80000,
      "pageSize": 8192,
      "autoVacuum": "INCREMENTAL"
    },
    "retention": {
      "scheduled": false,
      "note": "Retention job not currently scheduled in server.ts"
    },
    "cleanup": {
      "cadenceCleanupIntervalMs": {
        "source": "apps/memory-service/src/server.ts",
        "current": 3600000,
        "description": "Cleanup stale threads every hour"
      },
      "maxThreadAgeMs": {
        "source": "apps/memory-service/src/cadence.ts",
        "current": 86400000,
        "description": "Maximum thread age before cleanup (24h)"
      }
    }
  },
  "metrics": {
    "willBeCollectedBySimulator": true,
    "targets": [
      "turnsTotal",
      "reviewsTriggered",
      "memoriesSaved",
      "avgBytesPerMemory",
      "retrievalHitRate",
      "duplicateSaveRate",
      "extractP50",
      "extractP95",
      "reviewP50",
      "reviewP95",
      "chatTTFBDeltaWithAudit",
      "maxQueueDepth",
      "droppedJobs"
    ]
  }
}

